<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador De Slicers - Juan Miguel Rios Redondo</title>
    <!-- Librer√≠a PDF (Est√°ndar Industrial) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e67e22;
            --bg: #ecf0f1;
            --glass: rgba(255, 255, 255, 0.98);
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--primary);
            background-image: linear-gradient(135deg, #2c3e50 0%, #000000 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #333;
        }

        .main-panel {
            background-color: var(--glass);
            padding: 30px;
            border-radius: 16px;
            width: 95%;
            max-width: 950px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border-top: 8px solid var(--accent);
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }
        h1 { margin: 0; font-size: 28px; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; font-weight: 900; }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .control-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            transition: transform 0.2s;
        }
        .control-group:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }

        label { display: block; font-weight: 800; font-size: 12px; margin-bottom: 8px; color: #555; text-transform: uppercase; }
        
        select, input[type="number"], input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #eee;
            border-radius: 6px;
            font-size: 14px;
            background: #f9f9f9;
            box-sizing: border-box;
        }
        
        /* Input Color */
        input[type="color"] {
            -webkit-appearance: none; border: none; width: 100%; height: 38px; padding: 0; background: none; cursor: pointer; border-radius: 4px; overflow: hidden; margin-top: 5px;
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; }

        .quick-qty { display: flex; gap: 8px; margin-top: 10px; }
        .q-btn {
            flex: 1; background: #dfe6e9; border: none; padding: 8px; font-size: 11px; border-radius: 4px; cursor: pointer; color: #2d3436; font-weight: bold; transition: background 0.2s;
        }
        .q-btn:hover { background: #b2bec3; }
        .q-btn.active { background: var(--primary); color: white; }
        
        #btnTestQty { display: none; background-color: #f39c12; color: white; }

        .toggle-container {
            display: flex; background: #eee; border-radius: 6px; padding: 4px; margin-bottom: 15px;
        }
        .toggle-btn {
            flex: 1; text-align: center; padding: 8px; font-size: 12px; font-weight: bold; cursor: pointer; border-radius: 4px; color: #777;
        }
        .toggle-btn.active { background: white; color: var(--accent); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .mix-row {
            display: grid; grid-template-columns: 60px 1fr 40px; gap: 10px; margin-bottom: 8px; background: #f8f9fa; padding: 8px; border-radius: 6px; align-items: center;
        }
        .mix-row label { margin: 0; font-size: 11px; }
        .mix-row select { padding: 6px; font-size: 12px; }
        .mix-row input[type="color"] { margin-top: 0; height: 30px; }

        .btn-action {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            color: white; border: none; padding: 20px; width: 100%; font-size: 18px; font-weight: 800; border-radius: 8px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;
            box-shadow: 0 10px 20px rgba(230, 126, 34, 0.3); transition: all 0.3s; display: flex; justify-content: center; align-items: center; gap: 10px;
        }
        .btn-action:hover { transform: translateY(-3px); box-shadow: 0 15px 25px rgba(230, 126, 34, 0.4); }

        .info-box {
            background: #fadbd8; color: #922b21; padding: 15px; border-radius: 8px; font-size: 13px; margin-bottom: 20px; border-left: 4px solid #c0392b; font-weight: 600;
        }

        .visual-preview {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); gap: 4px; background: #95a5a6; padding: 15px; border-radius: 8px; margin-top: 20px; max-height: 200px; overflow-y: auto; border: 2px solid #7f8c8d;
        }
        .mini-strip { height: 12px; background: #2c3e50; border-radius: 2px; border: 1px solid rgba(255,255,255,0.2); }

        .footer-cr { text-align: center; margin-top: 30px; font-size: 12px; color: rgba(255,255,255,0.7); line-height: 1.5; }
        .footer-cr strong { color: #fff; }
        
        .custom-strip-input { display: none; margin-top:10px; padding:10px; background:#fef9e7; border:1px dashed #f39c12; border-radius:6px; }
        .diamond-color-wrapper { margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 10px; }
        
        /* Inputs Custom Sheet */
        .custom-sheet-container { display: none; margin-top:10px; padding:10px; background:#e8f6f3; border:1px dashed #1abc9c; border-radius:6px; }
        .custom-sheet-row { display: flex; gap: 10px; align-items: flex-end; }
        .custom-sheet-row > div { flex: 1; }
        .tech-badge { background:#c0392b; color:white; font-size:9px; padding:2px 5px; border-radius:3px; vertical-align:middle; margin-left:5px; }
    </style>
</head>
<body>

<div class="main-panel">
    <div class="header">
        <h1>Generador De Slicers</h1>
        <div style="font-size:12px; color:#777; margin-top:5px;">Herramienta Profesional de Producci√≥n</div>
    </div>

    <div class="controls-grid">
        <!-- GRUPO 1: PRODUCCI√ìN -->
        <div class="control-group">
            <label>1. Objetivo de Producci√≥n</label>
            <input type="number" id="totalStrips" value="72" min="1" onchange="updateCalc()">
            <div class="quick-qty">
                <button class="q-btn" id="btnTestQty" onclick="setQty(1)">Prueba (1)</button>
                <button class="q-btn" onclick="setQty(24)">1 Mesa (24)</button>
                <button class="q-btn" onclick="setQty(48)">2 Mesas (48)</button>
                <button class="q-btn active" onclick="setQty(72)">3 Mesas (72)</button>
            </div>
            <div style="margin-top:15px;">
                <label>Medida de Mesa</label>
                <select id="sizeType" onchange="updateCalc()">
                    <option value="mix">MIXTO (Configurable)</option>
                    <option value="10">Solo 10 Pies (14")</option>
                    <option value="9">Solo 9 Pies (12.5")</option>
                    <option value="8">Solo 8 Pies (11")</option>
                    <option value="custom">‚òÖ MEDIDA PERSONALIZADA</option>
                </select>
                <div id="customSizeContainer" class="custom-strip-input">
                    <label style="color:#d35400;">Distancia (Pulgadas):</label>
                    <input type="number" id="customVal" value="13.5" step="0.125" onchange="updateCalc()">
                </div>
            </div>
        </div>

        <!-- GRUPO 2: FORMATO -->
        <div class="control-group">
            <label>2. Formato de Salida</label>
            <div class="toggle-container">
                <div class="toggle-btn active" id="btnSheet" onclick="setMode('sheet')">HOJAS (PAGINADO)</div>
                <div class="toggle-btn" id="btnRoll" onclick="setMode('roll')">ROLLO (PLOTTER)</div>
            </div>
            
            <div id="panelSheet">
                <label>Tama√±o de Hoja</label>
                <select id="paperStandard" onchange="handlePaperChange()">
                    <option value="tabloid" selected>Tabloide (11" x 17")</option>
                    <option value="superTabloid">Super Tabloide (12" x 18")</option>
                    <option value="a3">A3 (29.7cm x 42cm)</option>
                    <option value="a3plus">A3+ / Super B (33cm x 48cm)</option>
                    <option value="custom_sheet" style="color:#16a085; font-weight:bold;">‚òÖ TAMA√ëO PERSONALIZADO...</option>
                    <option value="letter" style="color:#c0392b;">Carta (11" x 8.5") - [PRUEBA]</option>
                    <option value="legal" style="color:#c0392b;">Oficio (14" x 8.5") - [PRUEBA]</option>
                </select>
                
                <!-- INPUTS HOJA PERSONALIZADA -->
                <div id="customSheetContainer" class="custom-sheet-container">
                    <label style="color:#16a085; margin-bottom:5px;">Definir Medidas de la Hoja:</label>
                    <div class="custom-sheet-row">
                        <div>
                            <label>Ancho</label>
                            <input type="number" id="customSheetW" value="50" step="0.1" onchange="updateCalc()">
                        </div>
                        <div>
                            <label>Alto</label>
                            <input type="number" id="customSheetH" value="35" step="0.1" onchange="updateCalc()">
                        </div>
                        <div style="flex: 0.6;">
                            <label>Unidad</label>
                            <select id="customSheetUnit" onchange="updateCalc()">
                                <option value="cm">cm</option>
                                <option value="in">inch</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div id="panelRoll" style="display:none;">
                <label>Ancho del Rollo (cm)</label>
                <input type="number" id="rollWidth" value="60" onchange="updateCalc()">
                <small style="color:#888;">El sistema calcular√° el largo necesario.</small>
            </div>
            
            <!-- OPCI√ìN DE CORTE -->
            <div style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
                <label>M√©todo de Corte <span class="tech-badge">PRO</span></label>
                <select id="cutStyle" onchange="updateCalc()" style="border: 2px solid #e74c3c;">
                    <option value="laser" selected>üõë L√≠nea Roja (L√°ser/Troquelado)</option>
                    <option value="scissors">‚úÇÔ∏è L√≠nea Gris (Manual)</option>
                </select>
                <small style="display:block; margin-top:5px; color:#c0392b; font-size:11px;">
                    *La l√≠nea roja es universal para m√°quinas de corte.
                </small>
            </div>
        </div>

        <!-- GRUPO 3: PERSONALIZACI√ìN -->
        <div class="control-group">
            <label>3. Personalizaci√≥n</label>
            <div style="margin-bottom:15px;">
                <label>Etiqueta Central</label>
                <input type="text" id="labelText" value="ABPC" placeholder="Nombre del Club" onkeyup="updateCalc()">
            </div>
            
            <label>Colores de Fondo</label>
            
            <!-- Single Color Mode -->
            <div id="singleColorControl">
                <select id="bgMode" onchange="updateCalc()">
                    <option value="transparent" selected>Transparente</option>
                    <option value="black">Negro</option>
                    <option value="custom">Personalizado</option>
                </select>
                <input type="color" id="colorGlobal" value="#3498db" onchange="updateCalc()" style="display:none;">
            </div>

            <!-- Mix Color Mode -->
            <div id="mixColorControl" style="display:none;">
                <div class="mix-row">
                    <label>10 Pies:</label>
                    <select id="bgMix10" onchange="updateCalc()">
                        <option value="transparent" selected>Transparente</option>
                        <option value="black">Negro</option>
                        <option value="custom">Personalizado</option>
                    </select>
                    <input type="color" id="colorMix10" value="#e74c3c" onchange="updateCalc()" style="display:none;">
                </div>
                <div class="mix-row">
                    <label>9 Pies:</label>
                    <select id="bgMix9" onchange="updateCalc()">
                        <option value="transparent" selected>Transparente</option>
                        <option value="black">Negro</option>
                        <option value="custom">Personalizado</option>
                    </select>
                    <input type="color" id="colorMix9" value="#2ecc71" onchange="updateCalc()" style="display:none;">
                </div>
                <div class="mix-row">
                    <label>8 Pies:</label>
                    <select id="bgMix8" onchange="updateCalc()">
                        <option value="transparent">Transparente</option>
                        <option value="black">Negro</option>
                        <option value="custom" selected>Personalizado</option>
                    </select>
                    <input type="color" id="colorMix8" value="#3498db" onchange="updateCalc()">
                </div>
            </div>

            <!-- Nuevo: Color del Diamante -->
            <div class="diamond-color-wrapper">
                <label>Color del Diamante Central</label>
                <input type="color" id="diamondColor" value="#FFD700" onchange="updateCalc()">
            </div>
        </div>
    </div>

    <div class="info-box" id="statusMsg"></div>

    <button class="btn-action" onclick="generatePDF()">
        <span>‚¨á</span> Generar PDF Maestro
    </button>
    
    <label style="margin-top:20px; font-weight:bold; color:white;">Previsualizaci√≥n de Lote:</label>
    <div class="visual-preview" id="previewGrid"></div>
</div>

<div class="footer-cr">
    Herramienta desarrollada por <strong>Juan Miguel Rios Redondo</strong><br>
    <span id="copyright-text"></span>
</div>

<script>
    document.getElementById('copyright-text').innerText = "¬© " + new Date().getFullYear();

    // --- VARIABLES JUMBO ---
    let mode = 'sheet'; 
    const STRIP_H = 1.40; 
    const GAP_Y = 0.2; 
    const MARGIN = 0.3;
    const LINE_WIDTH_JUMBO = 0.08; 
    const DIAMOND_RADIUS = 0.40;   
    
    let calc = { paperW: 0, paperH: 0, cols: 0, rowsPerPage: 0, totalPages: 0, stripsPerPage: 0, stripsToPrint: [] };

    function setQty(n) {
        document.getElementById('totalStrips').value = n;
        document.querySelectorAll('.q-btn').forEach(b => {
            b.classList.remove('active');
            if (b.getAttribute('onclick').includes(`(${n})`)) {
                b.classList.add('active');
            }
        });
        updateCalc();
    }

    function handlePaperChange() {
        const pt = document.getElementById('paperStandard').value;
        const btnTest = document.getElementById('btnTestQty');
        const customContainer = document.getElementById('customSheetContainer');
        
        // Mostrar/Ocultar Inputs Custom
        if (pt === 'custom_sheet') {
            customContainer.style.display = 'block';
        } else {
            customContainer.style.display = 'none';
        }

        // L√≥gica de Prueba
        if (pt === 'letter' || pt === 'legal') {
            btnTest.style.display = 'block';
            setQty(1);
        } else {
            btnTest.style.display = 'none';
            if (parseInt(document.getElementById('totalStrips').value) === 1) {
                setQty(24);
            } else {
                updateCalc();
            }
        }
    }

    function setMode(m) {
        mode = m;
        document.getElementById('btnSheet').className = m === 'sheet' ? 'toggle-btn active' : 'toggle-btn';
        document.getElementById('btnRoll').className = m === 'roll' ? 'toggle-btn active' : 'toggle-btn';
        document.getElementById('panelSheet').style.display = m === 'sheet' ? 'block' : 'none';
        document.getElementById('panelRoll').style.display = m === 'roll' ? 'block' : 'none';
        
        if(m === 'sheet') {
            handlePaperChange(); 
        } else {
            document.getElementById('btnTestQty').style.display = 'none';
            if (parseInt(document.getElementById('totalStrips').value) === 1) {
                setQty(24);
            } else {
                updateCalc();
            }
        }
    }

    function resolveColor(selectId, inputId) {
        const mode = document.getElementById(selectId).value;
        const input = document.getElementById(inputId);
        if (mode === 'custom') {
            input.style.display = 'block';
            return { mode: 'custom', val: input.value };
        } else {
            input.style.display = 'none';
            return { mode: mode, val: null };
        }
    }

    function updateCalc() {
        const qty = parseInt(document.getElementById('totalStrips').value) || 24;
        const type = document.getElementById('sizeType').value;
        const customInput = document.getElementById('customSizeContainer');
        customInput.style.display = (type === 'custom') ? 'block' : 'none';
        
        const isMix = (type === 'mix');
        document.getElementById('singleColorControl').style.display = isMix ? 'none' : 'flex';
        document.getElementById('mixColorControl').style.display = isMix ? 'block' : 'none';

        const colGlobal = resolveColor('bgMode', 'colorGlobal');
        const col10 = resolveColor('bgMix10', 'colorMix10');
        const col9 = resolveColor('bgMix9', 'colorMix9');
        const col8 = resolveColor('bgMix8', 'colorMix8');

        calc.stripsToPrint = [];
        if (type === 'mix') {
            const base = Math.floor(qty / 3);
            let rem = qty % 3;
            for(let i=0; i < base + (rem>0?1:0); i++) calc.stripsToPrint.push({w:14.0, l:"10 Pies", colorCfg: col10});
            for(let i=0; i < base + (rem>1?1:0); i++) calc.stripsToPrint.push({w:12.5, l:"9 Pies", colorCfg: col9});
            for(let i=0; i < base; i++) calc.stripsToPrint.push({w:11.0, l:"8 Pies", colorCfg: col8});
        } else {
            let s = 14.0, l = "10 Pies";
            if(type==='9'){s=12.5; l="9 Pies";}
            if(type==='8'){s=11.0; l="8 Pies";}
            if(type==='custom') {
                s = parseFloat(document.getElementById('customVal').value) || 12.0;
                l = `Medida: ${s}"`;
            }
            for(let i=0; i<qty; i++) calc.stripsToPrint.push({w:s, l:l, colorCfg: colGlobal});
        }

        if (mode === 'sheet') {
            const pt = document.getElementById('paperStandard').value;
            // Medidas en pulgadas por defecto
            if(pt==='letter') { calc.paperW=11; calc.paperH=8.5; }
            else if(pt==='legal') { calc.paperW=14; calc.paperH=8.5; }
            else if(pt==='tabloid') { calc.paperW=17; calc.paperH=11; }
            else if(pt==='superTabloid') { calc.paperW=18; calc.paperH=12; }
            else if(pt==='a3') { calc.paperW=16.54; calc.paperH=11.69; }
            else if(pt==='a3plus') { calc.paperW=19; calc.paperH=13; }
            else if(pt==='custom_sheet') {
                const w = parseFloat(document.getElementById('customSheetW').value) || 10;
                const h = parseFloat(document.getElementById('customSheetH').value) || 10;
                const unit = document.getElementById('customSheetUnit').value;
                if(unit === 'cm') {
                    calc.paperW = w / 2.54;
                    calc.paperH = h / 2.54;
                } else {
                    calc.paperW = w;
                    calc.paperH = h;
                }
            }
        } else {
            const wCm = parseFloat(document.getElementById('rollWidth').value) || 60;
            calc.paperW = wCm / 2.54;
        }

        let maxStripW = 0;
        calc.stripsToPrint.forEach(s => { if(s.w > maxStripW) maxStripW = s.w; });
        const colWidth = maxStripW + 0.2; 
        
        const rowHeight = STRIP_H + GAP_Y;
        const usableW = calc.paperW - (MARGIN*2);
        
        calc.cols = Math.floor(usableW / colWidth);
        if(calc.cols < 1) calc.cols = 1; 

        if (mode === 'sheet') {
            const usableH = calc.paperH - (MARGIN*2) - 0.5;
            calc.rowsPerPage = Math.floor(usableH / rowHeight);
            calc.stripsPerPage = calc.cols * calc.rowsPerPage;
            if(calc.stripsPerPage < 1) calc.stripsPerPage = 1; 
            calc.totalPages = Math.ceil(qty / calc.stripsPerPage);
        } else {
            const totalRows = Math.ceil(qty / calc.cols);
            calc.paperH = (totalRows * rowHeight) + (MARGIN*2) + 1.0;
            calc.rowsPerPage = totalRows;
            calc.totalPages = 1;
        }

        const status = document.getElementById('statusMsg');
        const wCm = (calc.paperW * 2.54).toFixed(1);
        const hCm = (calc.paperH * 2.54).toFixed(1);
        
        const cutStyle = document.getElementById('cutStyle').value;
        const cutMsg = cutStyle === 'laser' ? "L√ÅSER (ROJO)" : "MANUAL (GRIS)";

        if(mode === 'sheet') {
            let note = "";
            const pt = document.getElementById('paperStandard').value;
            if(pt === 'letter' || pt === 'legal') {
                note = "<br><span style='color:#c0392b;'>‚ö†Ô∏è MODO PRUEBA VISUAL: La tira saldr√° cortada.</span>";
            }
            status.innerHTML = `<strong>Producci√≥n Paginada:</strong> ${calc.totalPages} p√°ginas (${wCm}x${hCm}cm).<br>Capacidad por hoja: ${calc.stripsPerPage} tiras. | Estilo: ${cutMsg}${note}`;
        } else {
            status.innerHTML = `<strong>Producci√≥n en Rollo:</strong> Archivo √∫nico de ${wCm}cm x ${hCm}cm. | Estilo: ${cutMsg}`;
        }

        const preview = document.getElementById('previewGrid');
        preview.innerHTML = '';
        calc.stripsToPrint.forEach(s => {
            const d = document.createElement('div');
            d.className = 'mini-strip';
            let bg = '#eee';
            let border = 'none';
            if(s.colorCfg.mode === 'transparent') { bg = '#ecf0f1'; border = '1px solid #999'; }
            else if (s.colorCfg.mode === 'black') { bg = '#2d3436'; }
            else { bg = s.colorCfg.val; }
            d.style.backgroundColor = bg;
            d.style.border = border;
            d.title = s.l;
            preview.appendChild(d);
        });
    }

    function hexToRgb(hex) {
        let result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? [parseInt(result[1], 16), parseInt(result[2], 16), parseInt(result[3], 16)] : [0, 0, 0];
    }

    function isDark(rgb) {
        const brightness = Math.round(((parseInt(rgb[0]) * 299) + (parseInt(rgb[1]) * 587) + (parseInt(rgb[2]) * 114)) / 1000);
        return brightness < 125;
    }

    function getColorTheme(cfg) {
        const dHex = document.getElementById('diamondColor').value;
        const cDiamond = hexToRgb(dHex);
        const cCyan = [0, 255, 255];
        const cWhite = [255, 255, 255];
        const cBlack = [15, 15, 15];
        
        if (cfg.mode === 'transparent') {
            return { fill: null, txt: [0,0,0], line: [0,128,128], gold: cDiamond };
        }
        if (cfg.mode === 'black') {
            return { fill: cBlack, txt: cWhite, line: cCyan, gold: cDiamond };
        }
        const bgRgb = hexToRgb(cfg.val);
        const txtRgb = isDark(bgRgb) ? cWhite : [0,0,0];
        const lineRgb = isDark(bgRgb) ? cCyan : [0,0,0];
        return { fill: bgRgb, txt: txtRgb, line: lineRgb, gold: cDiamond };
    }

    async function generatePDF() {
        const { jsPDF } = window.jspdf;
        const orientation = calc.paperW > calc.paperH ? 'l' : 'p';
        const doc = new jsPDF({ orientation, unit: 'in', format: [calc.paperW, calc.paperH] });
        const labelTxt = document.getElementById('labelText').value;
        const cutStyle = document.getElementById('cutStyle').value; 

        let cursorX = MARGIN;
        let cursorY = 1.0; 
        let itemsOnPage = 0;
        let colIdx = 0;
        
        let maxStripW = 0;
        calc.stripsToPrint.forEach(s => { if(s.w > maxStripW) maxStripW = s.w; });
        const colW = maxStripW + 0.2;

        const addFooter = (pNum) => {
            doc.setFontSize(8); doc.setTextColor(150);
            doc.text(`Desarrollado por Juan Miguel Rios Redondo - P√°g ${pNum}`, MARGIN, calc.paperH - 0.2);
        };
        const addHeader = (txt) => {
             doc.setFontSize(14); doc.setTextColor(0);
             doc.text(txt, calc.paperW/2, 0.5, {align:'center'});
             
             if (cutStyle === 'laser') {
                 doc.setFontSize(10); doc.setTextColor(231, 76, 60); 
                 doc.text("‚ö†Ô∏è NOTA T√âCNICA: L√≠nea ROJA (RGB 255,0,0) es TRAZO DE CORTE (CutContour).", calc.paperW/2, 0.7, {align:'center'});
             }
        };

        addHeader(`ORDEN DE PRODUCCI√ìN ABPC - ${calc.stripsToPrint.length} UNIDADES`);
        addFooter(1);

        calc.stripsToPrint.forEach((strip, i) => {
            if (mode === 'sheet' && itemsOnPage >= calc.stripsPerPage) {
                doc.addPage();
                cursorX = MARGIN; cursorY = 1.0; itemsOnPage = 0; colIdx = 0;
                addHeader("CONTINUACI√ìN"); addFooter(doc.internal.getNumberOfPages());
            }

            const theme = getColorTheme(strip.colorCfg);
            drawStripVector(doc, cursorX, cursorY, strip.w, STRIP_H, strip.l, labelTxt, theme, cutStyle);

            colIdx++; itemsOnPage++;
            if (colIdx >= calc.cols) {
                colIdx = 0; cursorX = MARGIN; cursorY += (STRIP_H + GAP_Y);
            } else {
                cursorX += colW;
            }
        });

        doc.save(`Slicers_JMRR_JUMBO_${calc.stripsToPrint.length}.pdf`);
    }

    function drawStripVector(doc, x, y, w, h, subLabel, mainLabel, theme, cutStyle) {
        if(theme.fill) {
            doc.setFillColor(theme.fill[0], theme.fill[1], theme.fill[2]);
            doc.rect(x, y, w, h, 'F');
        }

        if (cutStyle === 'laser') {
            doc.setDrawColor(255, 0, 0); 
            doc.setLineWidth(0.005); 
            doc.rect(x, y, w, h, 'S');
        } else if (cutStyle === 'scissors') {
            doc.setDrawColor(150); 
            doc.setLineWidth(0.01);
            doc.setLineDash([0.1, 0.1]); 
            doc.rect(x, y, w, h, 'S');
            doc.setLineDash([]); 
        }

        doc.setDrawColor(theme.line[0], theme.line[1], theme.line[2]);
        doc.setLineWidth(0.04); 
        doc.line(x, y+h/2, x+w, y+h/2);

        const step = w/10;
        doc.setLineWidth(LINE_WIDTH_JUMBO); 
        for(let t=1; t<10; t++) {
            if(t===5) continue;
            let tx = x + (step*t);
            doc.line(tx, y + h/2 - 0.3, tx, y + h/2 + 0.3);
        }

        doc.setFillColor(theme.gold[0], theme.gold[1], theme.gold[2]);
        const cx = x + w/2; const cy = y + h/2;
        const dR = DIAMOND_RADIUS; 
        doc.triangle(cx, cy-dR, cx+dR, cy, cx-dR, cy, 'F');
        doc.triangle(cx, cy+dR, cx+dR, cy, cx-dR, cy, 'F');

        doc.setTextColor(theme.txt[0], theme.txt[1], theme.txt[2]);
        doc.setFontSize(18); 
        doc.setFont("helvetica", "bold");
        doc.text(mainLabel, cx, y + h - 0.1, {align:'center'});

        doc.setFontSize(9); doc.setTextColor(100);
        doc.text(subLabel, x + 0.1, y + 0.15);
        
        const endSize = 0.30;
        doc.setFillColor(theme.line[0], theme.line[1], theme.line[2]);
        doc.triangle(x, y+h/2-endSize, x+endSize, y+h/2, x, y+h/2, 'F');
        doc.triangle(x, y+h/2+endSize, x+endSize, y+h/2, x, y+h/2, 'F');
        doc.triangle(x+w, y+h/2-endSize, x+w-endSize, y+h/2, x+w, y+h/2, 'F');
        doc.triangle(x+w, y+h/2+endSize, x+w-endSize, y+h/2, x+w, y+h/2, 'F');
    }

    updateCalc();
</script>

</body>
</html>

