<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador Universal</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: #2c3e50;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #ecf0f1;
        }

        /* --- CONTROLES (Solo pantalla) --- */
        .controls {
            background: #fff;
            color: #333;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            width: 95%;
            max-width: 900px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.4);
            border-top: 6px solid #e74c3c; /* Color rojo para atenci√≥n */
        }

        .input-row {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
            align-items: flex-start;
        }

        .input-group {
            flex: 1;
            min-width: 180px;
            text-align: left;
        }
        
        label { display: block; margin-bottom: 6px; font-weight: bold; font-size: 13px; color: #555; text-transform: uppercase; letter-spacing: 0.5px; }
        
        select, input {
            padding: 10px;
            font-size: 14px;
            border-radius: 6px;
            width: 100%;
            border: 1px solid #bdc3c7;
            background: #fdfdfd;
            height: 42px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        select:focus, input:focus { border-color: #e74c3c; outline: none; }

        /* Inputs condicionales */
        .conditional-input {
            display: none;
            margin-top: 8px;
            padding: 10px;
            background: #fff5e6; /* Naranja muy suave */
            border-radius: 6px;
            border: 1px dashed #f39c12;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        .btn-print {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 0 #c0392b;
            transition: transform 0.1s, background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn-print:hover { background-color: #c0392b; }
        .btn-print:active { transform: translateY(4px); box-shadow: none; }

        .info-bar {
            background-color: #ecf0f1;
            color: #2c3e50;
            padding: 10px;
            border-radius: 6px;
            font-size: 13px;
            margin-top: 15px;
            font-weight: bold;
            border-left: 5px solid #3498db;
            text-align: left;
        }

        /* Toggle Radio Buttons */
        .radio-group { display: flex; gap: 15px; margin-bottom: 5px; }
        .radio-group label { font-weight: normal; cursor: pointer; display: flex; align-items: center; gap: 5px; text-transform: none; }
        input[type="radio"] { width: auto; height: auto; margin: 0; }

        /* --- VISTA PREVIA --- */
        .preview-area {
            width: 100%;
            overflow: auto;
            background-color: #7f8c8d;
            padding: 40px;
            box-sizing: border-box;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            border: 1px solid #666;
        }

        /* --- HOJA DIN√ÅMICA --- */
        .sheet {
            background-color: white;
            padding: 0.25in; 
            box-sizing: border-box;
            display: flex;
            flex-direction: column; 
            align-items: center;
            justify-content: flex-start;
            gap: 0.12in; 
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            transform-origin: top center;
            transition: all 0.3s ease;
        }
        
        .sheet-header {
            width: 100%;
            text-align: center;
            border-bottom: 2px solid #333;
            margin-bottom: 0.1in;
            padding-bottom: 5px;
            font-weight: bold;
            font-size: 11pt;
            text-transform: uppercase;
            color: #333;
        }

        .strip-wrapper {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        /* L√≠neas de corte */
        .cut-line {
            width: 100%;
            border-top: 1px dashed #bbb;
            position: absolute;
            bottom: -0.06in; 
            left: 0;
            z-index: 0;
        }
        .sheet .strip-wrapper:last-child .cut-line { display: none; }

        .strip-label {
            font-size: 8pt;
            color: #999;
            font-weight: bold;
            width: 100%;
            text-align: left;
            position: absolute;
            top: -12px;
            left: 0;
        }

        svg { overflow: visible; display: block; z-index: 1; }
        text { font-family: 'Arial Black', Arial, sans-serif; font-weight: 900; }

        /* --- MODO IMPRESI√ìN ESTRICTO --- */
        @media print {
            @page {
                /* Esto ser√° sobrescrito por JS, pero es el fallback */
                margin: 0;
            }
            body { 
                background: none; 
                margin: 0; 
                padding: 0; 
                width: 100%;
                height: 100%;
            }
            .controls, .preview-area::-webkit-scrollbar { display: none !important; }
            .preview-area { 
                padding: 0; 
                background: none; 
                width: 100%; 
                display: block; 
                border: none;
                overflow: visible;
            }
            .sheet { 
                margin: 0; 
                box-shadow: none; 
                /* Forzar impresi√≥n de colores de fondo */
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
    <!-- Estilo Din√°mico de P√°gina para Control Total -->
    <style id="page-style"></style>
</head>
<body>

    <div class="controls">
        <div class="input-row">
            <!-- 1. TAMA√ëO PAPEL -->
            <div class="input-group">
                <label>1. TAMA√ëO EXACTO DE PAPEL:</label>
                <select id="paperSelect" onchange="handlePaperChange()">
                    <option value="tabloid">Tabloide (11" x 17")</option>
                    <option value="superTabloid">Super Tabloide (12" x 18")</option>
                    <option value="a3">A3 (29.7cm x 42cm)</option>
                    <option value="custom29x49">Recorte (29cm x 49cm)</option>
                    <option value="custom">üìè TAMA√ëO PERSONALIZADO...</option>
                </select>
                
                <!-- Personalizado -->
                <div class="conditional-input" id="customInputs" style="display:none; flex-wrap:wrap; gap:10px;">
                    <div style="flex:1"><label>Ancho (cm):</label><input type="number" id="customW" value="50" step="0.1" onchange="updateCustomSize()"></div>
                    <div style="flex:1"><label>Alto (cm):</label><input type="number" id="customH" value="40" step="0.1" onchange="updateCustomSize()"></div>
                </div>
            </div>

            <!-- 2. CONTENIDO -->
            <div class="input-group">
                <label>2. CONTENIDO / MEDIDA:</label>
                <select id="layoutSelect" onchange="handleLayoutChange()">
                    <option value="mix">MIXTO (Optimizado)</option>
                    <option value="10">SOLO 10 PIES (14")</option>
                    <option value="9">SOLO 9 PIES (12.5")</option>
                    <option value="8">SOLO 8 PIES (11")</option>
                    <option value="custom_strip">üìè MEDIDA MANUAL...</option>
                </select>
                
                <!-- Medida manual -->
                <div class="conditional-input" id="customStripInput" style="display:none;">
                    <label>Distancia Diamante-Diamante (pulgadas):</label>
                    <input type="number" id="customStripLenVal" value="13.0" step="0.125" onchange="renderSheet()">
                    <div style="font-size:10px; color:#e67e22; margin-top:3px;">*Mide de centro a centro exacto.</div>
                </div>
            </div>
            
            <!-- 3. FONDO -->
            <div class="input-group" style="max-width: 150px;">
                <label>3. FONDO:</label>
                <select id="bgMode" onchange="toggleColorPicker()">
                    <option value="transparent">Transparente</option>
                    <option value="black" selected>Negro</option>
                    <option value="custom">Color...</option>
                </select>
                <div class="conditional-input" id="colorPickerGroup" style="display:none; padding:5px;">
                    <input type="color" id="customColorInput" value="#1a5276" onchange="renderSheet()" style="height:35px; padding:2px;">
                </div>
            </div>
        </div>
        
        <!-- 4. ETIQUETA -->
        <div class="input-row" style="border-top: 1px dashed #ddd; padding-top: 15px; margin-top:15px;">
            <div class="input-group" style="flex: 2;">
                <label>4. ETIQUETA CENTRAL (LOGO/TEXTO):</label>
                <div class="radio-group">
                    <label><input type="radio" name="lblType" value="text" checked onchange="toggleLabelMode()"> Texto</label>
                    <label><input type="radio" name="lblType" value="image" onchange="toggleLabelMode()"> Imagen</label>
                </div>
                
                <div id="textInputContainer">
                    <input type="text" id="customLabelText" value="ABPC" placeholder="NOMBRE DEL CLUB" onkeyup="updateLabelText()">
                </div>
                
                <div id="imageInputContainer" style="display:none;">
                    <input type="file" id="customLabelImg" accept="image/*" onchange="handleImageUpload()">
                    <div id="imgStatus" style="font-size:11px; color:#27ae60; margin-top:2px; display:none;">‚úÖ Imagen cargada.</div>
                </div>
            </div>
            
            <div class="input-group">
                 <!-- Espacio vac√≠o para balancear -->
            </div>
        </div>

        <div class="info-bar" id="statusMsg">
            Calculando capacidad...
        </div>

        <button class="btn-print" onclick="window.print()">
            üíæ GUARDAR COMO PDF / IMPRIMIR
        </button>
        <div style="font-size:11px; color:#666; margin-top:5px;">
            <strong>Tip:</strong> En la ventana de impresi√≥n, selecciona "Guardar como PDF", Papel correcto y <strong>Escala: 100%</strong>.
        </div>
    </div>

    <div class="preview-area">
        <div class="sheet" id="sheetContent">
            <!-- Contenido JS -->
        </div>
    </div>

    <script>
        // Configuraci√≥n Base
        const STRIP_H_IN = 1.35; // Altura fija de la tira
        const MIN_GAP_IN = 0.12; // Espacio m√≠nimo
        const MARGIN_V_IN = 0.5; // Margen vertical

        // Variables de Estado
        let currentW = 17;
        let currentH = 11;
        let currentName = "Tabloide";
        let maxCapacity = 0;
        
        let labelMode = 'text';
        let labelTextStr = 'ABPC';
        let labelImgData = null; 
        let labelImgRatio = 1;

        // Tama√±os predefinidos
        const presets = {
            'tabloid': { w: 17, h: 11, name: 'Tabloide (11x17")' },
            'superTabloid': { w: 18, h: 12, name: 'Super Tabloide (12x18")' },
            'a3': { w: 16.54, h: 11.69, name: 'A3' }, 
            'custom29x49': { w: 19.29, h: 11.42, name: 'Recorte 29x49 cm' }
        };

        // --- MANEJO DE ETIQUETA ---
        function toggleLabelMode() {
            const radios = document.getElementsByName('lblType');
            for(let r of radios) if(r.checked) labelMode = r.value;
            
            document.getElementById('textInputContainer').style.display = labelMode === 'text' ? 'block' : 'none';
            document.getElementById('imageInputContainer').style.display = labelMode === 'image' ? 'block' : 'none';
            renderSheet();
        }

        function updateLabelText() {
            labelTextStr = document.getElementById('customLabelText').value || "";
            renderSheet();
        }

        function handleImageUpload() {
            const fileInput = document.getElementById('customLabelImg');
            const file = fileInput.files[0];
            const statusDiv = document.getElementById('imgStatus');
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        labelImgData = e.target.result;
                        labelImgRatio = img.width / img.height;
                        statusDiv.style.display = 'block';
                        renderSheet();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        // --- LOGICA PAPEL ---
        function handlePaperChange() {
            const val = document.getElementById('paperSelect').value;
            const customDiv = document.getElementById('customInputs');
            if (val === 'custom') {
                customDiv.style.display = 'flex';
                updateCustomSize(); 
            } else {
                customDiv.style.display = 'none';
                const p = presets[val];
                currentW = p.w;
                currentH = p.h;
                currentName = p.name;
                updateSystem();
            }
        }
        
        function handleLayoutChange() {
            const val = document.getElementById('layoutSelect').value;
            const customStripDiv = document.getElementById('customStripInput');
            customStripDiv.style.display = (val === 'custom_strip') ? 'block' : 'none';
            renderSheet();
        }

        function updateCustomSize() {
            const wCm = parseFloat(document.getElementById('customW').value) || 20;
            const hCm = parseFloat(document.getElementById('customH').value) || 20;
            currentW = wCm / 2.54;
            currentH = hCm / 2.54;
            currentName = `Personalizado (${wCm}x${hCm} cm)`;
            updateSystem();
        }

        function calculateCapacity() {
            const availableH = currentH - MARGIN_V_IN - 0.2; 
            const unitH = STRIP_H_IN + MIN_GAP_IN;
            let count = Math.floor(availableH / unitH);
            if (count < 1) count = 0;
            return count;
        }

        function updateSystem() {
            maxCapacity = calculateCapacity();
            const styleElem = document.getElementById('page-style');
            
            // Determinar orientaci√≥n para CSS Print
            const orientation = currentW > currentH ? 'landscape' : 'portrait';
            
            // INYECTAR CSS ESTRICTO DE P√ÅGINA
            // Esto le dice al di√°logo de impresi√≥n el tama√±o exacto del papel
            styleElem.innerHTML = `
                @page { 
                    size: ${currentW}in ${currentH}in; 
                    margin: 0; 
                }
            `;

            const sheet = document.getElementById('sheetContent');
            sheet.style.width = currentW + 'in';
            sheet.style.height = currentH + 'in';

            const msg = document.getElementById('statusMsg');
            let warn = "";
            if (currentW < 14.5) warn = " ‚ö†Ô∏è Papel angosto. Revisa si cabe la tira larga.";
            msg.innerHTML = `Papel: <strong>${currentName}</strong> (${currentW.toFixed(1)}" x ${currentH.toFixed(1)}") | Caben: <strong>${maxCapacity}</strong> Tiras. ${warn}`;
            msg.style.borderLeftColor = warn ? "#c0392b" : "#3498db";

            renderSheet();
        }

        function toggleColorPicker() {
            const mode = document.getElementById('bgMode').value;
            document.getElementById('colorPickerGroup').style.display = (mode === 'custom') ? 'block' : 'none';
            renderSheet();
        }

        // --- RENDERIZADO SVG ---
        const configs = {
            '10': { inches: 14.0, label: '10 Pies' },
            '9':  { inches: 12.5, label: '9 Pies' },
            '8':  { inches: 11.0, label: '8 Pies' },
            'custom_strip': { inches: 13.0, label: 'Personalizada' }
        };

        function getStripSVG(type) {
            if (type === 'custom_strip') {
                const customVal = parseFloat(document.getElementById('customStripLenVal').value) || 13;
                configs['custom_strip'].inches = customVal;
                configs['custom_strip'].label = `Medida: ${customVal}"`;
            }

            const conf = configs[type];
            const w = conf.inches;
            const h = STRIP_H_IN;
            
            const bgMode = document.getElementById('bgMode').value;
            let fillBody, strokeBorder, textColor, guideColor, tickColor;
            const cCyan = "#00FFFF"; 
            const cGold = "#FFD700";

            if (bgMode === 'transparent') {
                fillBody = "none"; strokeBorder = "#000"; textColor = "#000"; tickColor = "#009999"; guideColor = "#000";
            } else if (bgMode === 'black') {
                fillBody = "#111"; strokeBorder = "none"; textColor = "#FFF"; tickColor = cCyan; guideColor = "#FFF";
            } else {
                fillBody = document.getElementById('customColorInput').value; strokeBorder = "none";
                const isDark = parseInt(fillBody.substring(1), 16) < 0xffffff / 2;
                textColor = isDark ? "#FFF" : "#000"; guideColor = textColor; tickColor = isDark ? cCyan : "#000";
            }

            let ticks = "";
            const step = w / 10;
            for(let i=1; i<10; i++) {
                if(i===5) continue;
                ticks += `<line x1="${step*i}" y1="${(h/2)-0.25}" x2="${step*i}" y2="${(h/2)+0.25}" />`;
            }

            const cutBorder = `<rect x="0" y="0" width="${w}" height="${h}" rx="0.15" fill="none" stroke="#999" stroke-width="0.015" stroke-dasharray="0.1, 0.1"/>`;

            let labelContent = "";
            if (labelMode === 'image' && labelImgData) {
                const imgH = 0.35;
                const imgW = imgH * labelImgRatio;
                const imgX = (w / 2) - (imgW / 2);
                const imgY = h - 0.45;
                labelContent = `<image href="${labelImgData}" x="${imgX}" y="${imgY}" height="${imgH}" width="${imgW}" />`;
            } else {
                labelContent = `<text x="${w/2}" y="${h-0.15}" font-size="0.18" fill="${textColor}" text-anchor="middle" opacity="0.9">${labelTextStr}</text>`;
            }

            return `
            <div class="strip-wrapper">
                <div class="strip-label" style="color:${textColor === '#FFF' ? '#999' : '#555'}">${conf.label}</div>
                <svg width="${w}in" height="${h}in" viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">
                    <rect x="0" y="0" width="${w}" height="${h}" rx="0.15" fill="${fillBody}" stroke="${strokeBorder}" stroke-width="0.02"/>
                    ${bgMode !== 'black' && bgMode !== 'custom' ? cutBorder : ''}
                    <line x1="0" y1="${h/2}" x2="${w}" y2="${h/2}" stroke="${tickColor}" stroke-width="0.01" opacity="0.5"/>
                    <g stroke="${tickColor}" stroke-width="0.04">${ticks}</g>
                    <polygon points="${w/2},${h/2-0.25} ${w/2+0.3},${h/2} ${w/2},${h/2+0.25} ${w/2-0.3},${h/2}" fill="${cGold}" stroke="#B8860B" stroke-width="0.01"/>
                    ${labelContent}
                    <path d="M0,${h/2} L0.25,${h/2+0.2} L0.25,${h/2-0.2} Z" fill="${guideColor}" opacity="0.8"/>
                    <path d="M${w},${h/2} L${w-0.25},${h/2+0.2} L${w-0.25},${h/2-0.2} Z" fill="${guideColor}" opacity="0.8"/>
                </svg>
                <div class="cut-line"></div>
            </div>`;
        }

        function renderSheet() {
            const layoutType = document.getElementById('layoutSelect').value;
            const container = document.getElementById('sheetContent');
            
            let html = `<div class="sheet-header">PLANTILLA ${labelTextStr} - ${currentName}</div>`;

            if (maxCapacity > 0) {
                if (layoutType === 'mix') {
                    const base = Math.floor(maxCapacity / 3);
                    let rem = maxCapacity % 3;
                    const c10 = base + (rem > 0 ? 1 : 0);
                    const c9 = base + (rem > 1 ? 1 : 0);
                    const c8 = base;

                    for(let i=0; i<c10; i++) html += getStripSVG('10');
                    for(let i=0; i<c9; i++) html += getStripSVG('9');
                    for(let i=0; i<c8; i++) html += getStripSVG('8');
                } else {
                    for(let i=0; i<maxCapacity; i++) html += getStripSVG(layoutType);
                }
            } else {
                html += `<div style="padding:20px; color:red; font-weight:bold;">El papel es muy peque√±o para imprimir tiras.</div>`;
            }

            container.innerHTML = html;
        }

        updateSystem();
    </script>
</body>
</html>
